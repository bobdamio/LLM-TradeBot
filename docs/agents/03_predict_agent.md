# ğŸ”® PredictAgent (The Prophet)

> é¢„æµ‹é¢„è¨€å®¶ - ML é©±åŠ¨çš„ä»·æ ¼èµ°åŠ¿é¢„æµ‹

## æ¦‚è¿°

PredictAgent æ˜¯å¤š Agent æ¡†æ¶çš„é¢„æµ‹å¼•æ“ï¼Œä½¿ç”¨ LightGBM æœºå™¨å­¦ä¹ æ¨¡å‹é¢„æµ‹æœªæ¥ 30 åˆ†é’Ÿçš„ä»·æ ¼ä¸Šæ¶¨æ¦‚ç‡ï¼Œä¸ºå†³ç­–å±‚æä¾›æ•°æ®é©±åŠ¨çš„ä¿¡å·ã€‚

## æ ¸å¿ƒèŒè´£

1. **æ¦‚ç‡é¢„æµ‹** - è¾“å‡ºæœªæ¥ 30 åˆ†é’Ÿä»·æ ¼ä¸Šæ¶¨æ¦‚ç‡ (0.0 ~ 1.0)
2. **åŒæ¨¡å¼æ”¯æŒ** - ML æ¨¡å‹ä¼˜å…ˆï¼Œæ— æ¨¡å‹æ—¶å›é€€åˆ°è§„åˆ™è¯„åˆ†
3. **ç‰¹å¾å·¥ç¨‹** - å¤„ç† 80+ æŠ€æœ¯ç‰¹å¾
4. **è‡ªåŠ¨è®­ç»ƒ** - æ¯ 2 å°æ—¶è‡ªåŠ¨é‡æ–°è®­ç»ƒæ¨¡å‹

## æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PredictAgent                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å…¥ï¼šfeatures Dict (æ¥è‡ª TechnicalFeatureEngineer)              â”‚
â”‚   - 80+ æŠ€æœ¯ç‰¹å¾                                                 â”‚
â”‚   - ä»·æ ¼ä½ç½®ã€è¶‹åŠ¿å¼ºåº¦ã€åŠ¨é‡ã€æ³¢åŠ¨ç‡ã€æˆäº¤é‡ç­‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é¢„å¤„ç†ï¼š_preprocess_features                              â”‚   â”‚
â”‚  â”‚   â€¢ å¤„ç† NaN/Inf å¼‚å¸¸å€¼                                   â”‚   â”‚
â”‚  â”‚   â€¢ ç‰¹å¾é»˜è®¤å€¼å¡«å……                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â–¼                         â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ML æ¨¡å‹é¢„æµ‹      â”‚    â”‚   è§„åˆ™è¯„åˆ†é¢„æµ‹     â”‚                â”‚
â”‚  â”‚  (LightGBM)       â”‚    â”‚   (Fallback)      â”‚                â”‚
â”‚  â”‚                   â”‚    â”‚                   â”‚                â”‚
â”‚  â”‚ predict_proba()   â”‚    â”‚ åŠ æƒè§„åˆ™ç³»ç»Ÿ       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚              â”‚                         â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                           â–¼                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾“å‡ºï¼šPredictResult                                              â”‚
â”‚   - probability_up: ä¸Šæ¶¨æ¦‚ç‡ (0.0 ~ 1.0)                        â”‚
â”‚   - probability_down: ä¸‹è·Œæ¦‚ç‡                                   â”‚
â”‚   - confidence: ç½®ä¿¡åº¦                                           â”‚
â”‚   - signal: "bullish" / "bearish" / "neutral"                   â”‚
â”‚   - factors: Top 5 é‡è¦ç‰¹å¾                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®æ•°æ®ç»“æ„

### PredictResult

```python
@dataclass
class PredictResult:
    probability_up: float      # ä¸Šæ¶¨æ¦‚ç‡ (0.0 ~ 1.0)
    probability_down: float    # ä¸‹è·Œæ¦‚ç‡
    confidence: float          # ç½®ä¿¡åº¦
    horizon: str               # é¢„æµ‹å‘¨æœŸ (é»˜è®¤ "30m")
    factors: Dict[str, float]  # é‡è¦ç‰¹å¾åŠå…¶è´¡çŒ®
    model_type: str            # "ml_lightgbm" / "rule_based"
    timestamp: datetime
    
    @property
    def signal(self) -> str:
        if self.probability_up > 0.55:
            return "bullish"
        elif self.probability_up < 0.45:
            return "bearish"
        return "neutral"
```

## ML æ¨¡å‹è®­ç»ƒ

### æ ‡ç­¾ç”Ÿæˆ (LabelGenerator)

```python
# æ ¸å¿ƒå‚æ•°
horizon_minutes = 30   # é¢„æµ‹æœªæ¥ 30 åˆ†é’Ÿ
up_threshold = 0.001   # æ¶¨å¹…é˜ˆå€¼ 0.1%

# æ ‡ç­¾è®¡ç®—
future_price = df['close'].shift(-6)  # 6 ä¸ª 5m K çº¿ = 30 åˆ†é’Ÿ
returns = (future_price - current_price) / current_price
label = 1 if returns > 0.001 else 0
```

### ç‰¹å¾å·¥ç¨‹ (TechnicalFeatureEngineer)

| ç‰¹å¾ç±»åˆ« | æ•°é‡ | ç¤ºä¾‹ |
|----------|------|------|
| ä»·æ ¼ç›¸å¯¹ä½ç½® | 8 | `price_to_sma20_pct`, `bb_position` |
| è¶‹åŠ¿å¼ºåº¦ | 10 | `ema_cross_strength`, `macd_momentum` |
| åŠ¨é‡ | 8 | `rsi_divergence`, `rsi_slope` |
| æ³¢åŠ¨ç‡ | 8 | `atr_ratio`, `volatility_breakout` |
| æˆäº¤é‡ | 8 | `volume_surge`, `vwap_deviation` |
| ç»„åˆç‰¹å¾ | 8+ | `trend_confirmation_score` |

### è‡ªåŠ¨è®­ç»ƒ (ProphetAutoTrainer)

```python
# é…ç½®
interval_hours = 2.0     # æ¯ 2 å°æ—¶è®­ç»ƒ
training_days = 7        # ä½¿ç”¨ 7 å¤©å†å²æ•°æ®

# è®­ç»ƒæµç¨‹
1. è·å–å†å² K çº¿ (çº¦ 2016 æ¡)
2. è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
3. æ„å»ºç‰¹å¾
4. ç”Ÿæˆæ ‡ç­¾
5. 80/20 è®­ç»ƒ/éªŒè¯åˆ†å‰²
6. LightGBM è®­ç»ƒ
7. ä¿å­˜æ¨¡å‹åˆ° models/prophet_lgb_{symbol}.pkl
8. é‡æ–°åŠ è½½åˆ° PredictAgent
```

## å¤šå¸ç§æ”¯æŒ

æ¯ä¸ªäº¤æ˜“å¯¹ç‹¬ç«‹çš„ PredictAgent å’Œæ¨¡å‹æ–‡ä»¶ï¼š

```
models/
â”œâ”€â”€ prophet_lgb_BTCUSDT.pkl
â”œâ”€â”€ prophet_lgb_ETHUSDT.pkl
â”œâ”€â”€ prophet_lgb_SOLUSDT.pkl
â””â”€â”€ prophet_lgb_BNBUSDT.pkl
```

## ä¾èµ–å…³ç³»

```
PredictAgent
â”œâ”€â”€ ProphetMLModel (src/models/prophet_model.py)
â”œâ”€â”€ TechnicalFeatureEngineer (src/features/technical_features.py)
â””â”€â”€ ProphetAutoTrainer (è‡ªåŠ¨è®­ç»ƒ)
```

## é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| horizon | "30m" | é¢„æµ‹æ—¶é—´èŒƒå›´ |
| symbol | "BTCUSDT" | äº¤æ˜“å¯¹ |
| model_path | è‡ªåŠ¨ç”Ÿæˆ | æ¨¡å‹æ–‡ä»¶è·¯å¾„ |

## ä½¿ç”¨ç¤ºä¾‹

```python
from src.agents.predict_agent import PredictAgent

# åˆå§‹åŒ– (è‡ªåŠ¨åŠ è½½æ¨¡å‹)
agent = PredictAgent(horizon='30m', symbol='BTCUSDT')

# é¢„æµ‹
result = await agent.predict(features)

print(f"ä¸Šæ¶¨æ¦‚ç‡: {result.probability_up:.2%}")
print(f"ä¿¡å·: {result.signal}")
print(f"ç½®ä¿¡åº¦: {result.confidence:.2%}")
```

## æ—¥å¿—è¾“å‡º

Dashboard æ—¥å¿—æ ¼å¼ï¼š

```
ğŸ”® PredictAgent (The Prophet): ğŸ“ˆ P(Up)=56.5% | Signal: bullish | Conf: 65%
```

ç¬¦å·è¯´æ˜ï¼š

- ğŸ“ˆ P(Up) > 55%
- ğŸ“‰ P(Up) < 45%
- â¡ï¸ å…¶ä»–
